---
title: "SDS_Wind_Infrastructre"
author: "Sofia Ingersoll"
format: html
editor: visual
---

In this documentation, the data utilized is the [US Wind Data](https://dataverse.harvard.edu/file.xhtml?fileId=7339850&version=1.0), this data is associated with the "Replication Data for: Prevalence and predictors of wind energy opposition in North America", <https://doi.org/10.7910/DVN/LE2V0R>, Harvard Dataverse, V1, 2023. The collaborators on that project include: Stokes, Leah; Franzblau, Emma; Lovering, Jessica R.; Miljanich, Chris.

\~ include more about what the data is about and the outcomes of making visualization \~

Analysis of these areas will provide insight into local resistance and spatially distorted signalling in relation to wind power infrastructure and climate policy.

### Loading Libraries

The following libraries were selected based on their functionality and ability to optimize our data for mapping.

```{r, message = FALSE}
# Loading Libraries
library(tidyverse)        # essential r package 
library(sf)               # package simplifies spatial dataframes
library(cowplot)
library(raster)
library(naniar)
library(tmap)
library(terra)
library(stars)
library(devtools)
library(maptiles)
library(smoothr)          # aesthetic and visual aid for buffers created
```

### Read in the Data

To simplify the following step, it is important to organize your folders in a way that makes sense for your workflow. In many cases, the data sets we work with are typically too large to be uploaded to GitHub. As a result, a common practice is storing your data in a folder, directly outside of your repository in a folder labeled "data".

The code chunk below for `read.csv` demonstrates how to exit your current location using `..` and enter the desired folder location using `/`. It is important that your file path does not contain any spaces and is directly reflective of the file path for the data you wish to read in.

#### U.S. Wind Data

```{r}
# reading in & storing data
wind_data <- read.csv("../data/wind_data/wind_data_usa.csv")  
```

##### Confirm the Data Loaded Properly

```{r}
head(wind_data)                  # displays the first 6 rows of the data
                                 # along with all of the columns 
```

## Wrangling & Subsetting

### **Converting lat/long into Raster Data (i.e. sticky geometries)**

Below we will use the package `sf` to convert the lat/long data into a raster geometry column. In this single line, we will also be assigning the CRS EPSG:4326 to the sf data frame. Coordinate Reference Systems, CRS, are required in order for the data to be projected onto a map. The CRS was selected because it provides a relatively proportionate display of the United States. We are open to suggestions regarding our CRS if a different project better fits our data.

```{r}
wind_sf <- wind_data %>%             # calls desired dataset
  st_as_sf(coords = c("longitude", "latitude"), crs = 3857) 
                                     # creates geometry column with desired crs 

glimpse(crs(wind_sf))                  # output should reveal WGS84, EPSG:4326
```

#### Check-point

Let's stop and see if our outputs are what we expect.

Were the lat/long columns correctly converted into a geometry column?

`setdiff()` is a way to quickly determine the differences between two data sets.

```{r}
setdiff(colnames(wind_data), colnames(wind_sf))
setdiff(colnames(wind_sf), colnames(wind_data))
```

### Initial Visualization of the Data

Using the base R function `plot()`, we can see that the geometries stored by this data set correlate to the locations of wind infrastructure plants throughout the United States. In order to visualize these locations with respect to state and county jurisdictions, we'll need to utilize another data set to create a base layer for our map.

```{r}
# First visual of the U.S. wind data provided by the geometry points
plot(wind_sf$geometry)
```

```{r}
tmap_mode('plot')
#Create a map to plot the percent of suitable area 
tm_shape(wind_sf) +
  tm_bubbles() +                             
  tm_basemap(server = 'OpenStreetMap') 
```

# Multivariate Linear Regression Models

### Variables of interest:

| Name         | Description                                                                                                 |
|------------------------------------|------------------------------------|
| status       | describes the operating status of wind infrastructure, binary variable. 1 is operating, 0 is not_operating. |
| is_anti_wind | binary variable to describe the public opinion regarding local wind infrastructure.                         |
| pop_den      | population density of census tract ids within 3km buffer of wind infrastructure.                            |
| med_inc      | defines the median income of census tract ids within 3km buffer zone of wind infrastructure.                |
| median_age   | describes the median age of census tract ids within 3 km radius of wind infrastructure.                     |

An attribute from each column will be used to run several multivariate linear regression models. This is to assess the effects of socioeconmic/regional influences on wind infrastructure and the estimated likelihood of participating legislative action when living within a 3km proximity of a wind plant.

## Determining Variable Assignments for OLS

```{r}
unique(wind_sf$status)     # displays unique values in this
```

### Need to rename status output variables

```{r}
# creating two categories: operating & not_operating
# We are removing 'Operating | Decommissioned' because it skews the data
unwanted_status <- "Operating | Decommissioned"
replacement_status <- "Uncertain Status"
wind_sf$status[wind_sf$status== unwanted_status]<-"Uncertain Status"  

# were we successful ?
unique(wind_sf$status)     # displays unique values in this

# cleaning out NAs for OLS
wind_sf <- wind_sf %>%
  filter(is.na(status) == 'FALSE') %>% 
  filter(is.na(is_anti_wind) == 'FALSE') %>% 
  filter(is.na(pop_den) == 'FALSE') %>% 
  filter(is.na(med_inc) == 'FALSE') %>% 
  filter(is.na(median_age) == 'FALSE') %>% 
  filter(is.na(n_turbs) == 'FALSE')

# were we successful ?
unique(wind_sf$status)     # displays unique values in this

# if_else preserves the data type but replaces unwanted values
wind_us <- wind_sf %>% 
  mutate(status = if_else(
    status %in% c('Cancelled', 'Out of service (temporarily)', 'Standby', 'Decommissioned', 'Uncertain Status'), 'not_operating',
    'operating') 
  )

# are our only outputs "operating" and "not_operating"?
print(unique(wind_us$status))

# status as factor and reassigned values
wind_us <- wind_us %>% 
  mutate(status = case_when(status == "operating" ~ 1,
            status == "not_operating" ~ 0))

# are our only outputs 0 or 1?
print(unique(wind_us$status))
```

Binary variable will be `status` column: `opertating` is 1, and `not_operating` will be 0.

```{r}
ggplot(data = wind_us, aes(x = pop_den, y = status)) + 
  geom_jitter(width = 0, height = 0.05, alpha = 0.8) +
   labs(x = "Population Density", y = "Wind Infrastructure Operating Status")
```

#### Proposed Estimation Equations:

The first four equations estimate the likelihood of taking political action when considering a regions' wind turbine status, median income, and median age.

## Logistic Regressions with Binomial Family:

$$logit(p)=log( p / 1−p)=β0+β1x+ε$$

$$
p̂=e^(β0+β1x1+eβ0+β1x)
$$

### 1 Binary Variable

$$ \text{status}\ = \beta_0 + \beta_1 \text{is_anti_wind}\_i + \varepsilon_i $$ When wind turbines are operational, and all other variables are held constant at 0, the $\beta_0$ represents the estimated likelihood that `status` of a wind infrastructure plant is `operating` is \~ `4.48`. $\beta_1$ tells us there is an estimated decrease of `2.80` in probability that status would be `operating` for the average unit increase in `is_anti_wind` opinion holders.

Our summary table describes a null deviance `362.89`.(`1182 df`) and residual deviance `292.28` (`1181 df`). Additionally, it provides a p-value of `8.1e-15` for $\beta_1$, indicating that the hypothesis here is rejected because it is drastically smaller than the `significant value of 0.05`. However, I am still not convinced there isn't a correlation between the two, so let's explore how our numbers change as we incorporate more variables into our equation.

```{r}
# Inital regression 1 betas for null
status1 <- summary(glm(status ~ is_anti_wind,
                       wind_us,
                       family = 'binomial'))

# show me a summary table 
summary(status1)
```

## Assessing Omitted Variables Bias in OLS

### OLS with 2 Variables

$$ \text{status}\ = \beta_0 + \beta_1 \text{is_anti_wind}\_i + \beta_2 \text{pop_den} + \varepsilon_i $$ When wind turbines are operational, and all other variables are held constant at 0, the $\beta_0$ represents the estimated likelihood that `status` of a wind infrastructure plant is `operating` is \~ `4.47`. $\beta_1$ tells us there is an estimated decrease of `2.79` in probability that status would be `operating` for the average unit increase in `is_anti_wind` opinion holders. For every average unit increase in `pop_den`, $\beta_2$ predicts `7.6e-05` will increase the `operating status`, indicating `pop_den` is an extremely marginal influence, that may potentially be interacting with `is_anti_wind` outlook.

Our summary table describes a null deviance `362.60`.(`1178 df`) and residual deviance `292.13` (`1176 df`). Additionally, it provides a p-value of `9.5e-15` for $\beta_1$, indicating that the hypothesis here is rejected because it is drastically smaller than the `significant value of 0.05`. The p-value of $\beta_2$, `0.819` is acceptable because it is within range of the significant value.

```{r}
# Initial regression 2 betas for null
status2 <- summary(glm(status ~ is_anti_wind + pop_den,
                       wind_us,
                       family = 'binomial'))

summary(status2)
```

### OLS with 3 Variables

$$ \text{status}\ = \beta_0 + \beta_1 \text{is_anti_wind}\_i + + \beta_2 \text{pop_den } + \beta_3 \text{med_inc} + \varepsilon_i $$ When wind turbines are operational, and all other variables are held constant at 0, the $\beta_0$ represents the estimated likelihood that `status` of a wind infrastructure plant is `operating` is \~ `5.35`. $\beta_1$ tells us there is an estimated decrease of `2.80` in probability that status would be `operating` for the average unit increase in `is_anti_wind` opinion holders. For every average unit increase in `pop_den`, $\beta_2$ predicts `1.65e-04` will increase the `operating status`. The dramatic change in `pop_den` estimated influence on `status` is likely due to an interaction relationship with `med_inc`, which intuitively makes sense. $\beta_3$ predicts `1.74e-04` will decrease the `operating status`, for an average unit increase in `med_inc`.

Our summary table describes a null deviance `362.60`.(`1178 df`) and residual deviance `289.8` (`1175 df`). Additionally, it provides a p-value of `1.03e-14` for $\beta_1$, indicating that the hypothesis here is rejected because it is drastically smaller than the `significant value of 0.05`. The p-value of $\beta_2$, `0.668` is acceptable because it is within range of the significant value. The p-value of $\beta_3$, `0.103` is acceptable because it is within range of the significant value.

```{r}
# Regression with 3 beta
status3 <- summary(glm(status ~ is_anti_wind + pop_den + med_inc, 
                       wind_us,
                       family = 'binomial'))

summary(status3)
```

### OLS with 4 Variables

$$ \text{status}\ = \beta_0 + \beta_1 \text{is_anti_wind}\_i + + \beta_2 \text{pop_den} + \beta_3 \text{med_inc} + \beta_4 \text{med_age} + \varepsilon_i $$

When wind turbines are operational, and all other variables are held constant at 0, the $\beta_0$ represents the estimated likelihood that `status` of a wind infrastructure plant is `operating` is \~ `4.23`. $\beta_1$ tells us there is an estimated decrease of `2.81` in probability that status would be `operating` for the average unit increase in `is_anti_wind` opinion holders. For every average unit increase in `pop_den`, $\beta_2$ predicts `1.65e-04` will increase the `operating status`, indicating `pop_den` is an extremely marginal influence, that may potentially be interacting with `is_anti_wind` outlook. $\beta_3$ predicts `1.79e-05` will decrease the `operating status`, for an average unit increase in `med_inc`. $\beta_4$ estimates an increase of `2.73e-02` in the `operating status`, for each average unit increase in `med_age`.

Our summary table describes a null deviance `362.60`.(`1178 df`) and residual deviance `289.02` (`1174 df`). Additionally, it provides a p-value of `9.17e-15` for $\beta_1$, indicating that the hypothesis here is rejected because it is drastically smaller than the `significant value of 0.05`. The p-value of $\beta_2$, `0.553` is acceptable because it is within range of the significant value. The p-value of $\beta_3$, `0.096` is acceptable because it is within range of the significant value. The p-value of $\beta_4$, \~`0.370` is acceptable because it is within range of the significant value.

```{r}
# Regression with 4
status4 <- glm(status ~ is_anti_wind + pop_den + med_inc + median_age, 
                       wind_us,
                       family = 'binomial')

summary(status4)
```

### OLS with Interacting Variables

##### Population Density \* Is Anti Wind Opinion

$$ \text{status}\ = \beta_0 + \beta_1 \text{is_anti_wind}\_i + \beta_2 \text{pop_den} + \beta_3 \text{pop_den * is_anti_wind} + \varepsilon_i $$

When wind turbines are operational, and all other variables are held constant at 0, the $\beta_0$ represents the estimated likelihood that `status` of a wind infrastructure plant is `operating` is \~ `4.46`. $\beta_1$ tells us there is an estimated decrease of `2.79` in probability that status would be `operating` for the average unit increase in `is_anti_wind` opinion holders. For every average unit increase in `pop_den`, $\beta_2$ predicts `1.09e-04` will increase the `operating status`. The dramatic change in `pop_den` estimated influence on `status` is likely due to an interaction relationship with `med_inc`, which intuitively makes sense.

What is interaction telling us?

$\beta_3$ predicts `5.91e-05` will decrease the `operating status`, for an average unit increase in `pop_den * is_anti_wind`.

Our summary table describes a null deviance `362.60`.(`1178 df`) and residual deviance `292.12` (`1175 df`). Additionally, it provides a p-value of `6.52e-14` for $\beta_1$, indicating that the hypothesis here is rejected because it is drastically smaller than the `significant value of 0.05`. The p-value of $\beta_2$, `0.837` is acceptable because it is within range of the significant value. The p-value of $\beta_3$, `0.931` is acceptable because it is within range of the significant value.

```{r}
# Regression with interacting beta
status5 <- summary(glm(status ~ is_anti_wind + pop_den + pop_den * med_inc, 
                       wind_us,
                       family = 'binomial'))

status5
```

##### Population Density \* Median Income

FIX THE WORDS HERE

##### $$ \text{status}\ = \beta_0 + \beta_1 \text{is_anti_wind}\_i + \beta_2 \text{pop_den} + \beta_3 \text{pop_den * med_inc} + \varepsilon_i $$

When wind turbines are operational, and all other variables are held constant at 0, the $\beta_0$ represents the estimated likelihood that `status` of a wind infrastructure plant is `operating` is \~ `4.23`.

$\beta_1$ tells us there is an estimated decrease of `2.81` in probability that status would be `operating` for the average unit increase in `is_anti_wind` opinion holders.

For every average unit increase in `pop_den`, $\beta_2$ predicts `1.65e-04` will increase the `operating status`, indicating `pop_den` is an extremely marginal influence, that may potentially be interacting with `is_anti_wind` outlook.

$\beta_3$ predicts `1.79e-05` will decrease the `operating status`, for an average unit increase in `med_inc`.

$\beta_4$ estimates an increase of `2.73e-02` in the `operating status`, for each average unit increase in `med_age`.

Our summary table describes a null deviance `362.60`.(`1178 df`) and residual deviance `289.02` (`1174 df`).

Additionally, it provides a p-value of `9.17e-15` for $\beta_1$, indicating that the hypothesis here is rejected because it is drastically smaller than the `significant value of 0.05`.

The p-value of $\beta_2$, `0.553` is acceptable because it is within range of the significant value.

The p-value of $\beta_3$, `0.096` is acceptable because it is within range of the significant value.

The p-value of $\beta_4$, \~`0.370` is acceptable because it is within range of the significant value.

```{r}
# Regression with interacting beta
status6 <- glm(status ~ is_anti_wind + pop_den + pop_den + med_inc + median_age + pop_den * med_inc, 
                       wind_us,
                       family = 'binomial')

summary(status6)
```

## Interpreting Omitted Variable Bias (OVB)

$\text{Null Deviance} = \text{2(LL(Saturated Model)} - \text{LL(Null Model)) on df} = \text{df_Sat - df_Null}$

[Null deviance]{.underline}: tells us how well the response variable can be predicted by a model with only an intercept term.

$\text {Residual Deviance} = \text{2(LL(Saturated Model)} - \text{LL(Proposed Model))} \text{df} = \text {df_Sat} - \text{df_Proposed}$

[Residual Deviance]{.underline}: tells us how well the response variable can be predicted by a model with p predictor variables.

$\text {The Saturated Model is a model that assumes each data point has its own parameters (which means you have n parameters to estimate.)}$

$\text {The Null Model assumes the exact "opposite", in that is assumes one parameter for all of the data points, which means you only estimate 1 parameter.}$

$\text{The Proposed Model assumes you can explain your data points with p parameters + an intercept term, so you have p+1 parameters.}$

When the **Null Deviance** is really small, it means that the Null Model explains the data pretty well. The same goes for **Residual Deviance\[[1](https://stats.stackexchange.com/questions/108995/interpreting-residual-and-null-deviance-in-glm-r)\]**. To best interpret our models, we will compare the `Residual deviance.`

### Comparing Models using anova

Comparing our 6 residual deviance outputs, models 6 and 4 produced the smallest residual deviance at `288.84` and `289.02` respectively. To determine which is the best fit, we will do an anova assessment.

```{r}
# this takes into consideration the predicted p value using both the null and residual deviation of each model and determines which more accurately describes the data
model_comparison <- anova(status6, status4, test = "Chisq") 

model_comparison
```

Our best fit OLS model is our interaction model 6: $$ \text{status}\ = \beta_0 + \beta_1 \text{is_anti_wind}\_i + + \beta_2 \text{pop_den} + \beta_3 \text{med_inc} + \beta_4 \text{med_age} + \varepsilon_i $$

### Constructing Confidence Interval

#### Best Fit OLS Model 6

Model 6 is restricted to 1173 degrees of freedom, as output by our earlier OLS exploration. We will apply that value when constructing our 95% Confidence Intervals.

```{r}
# Constructing a 95% confidence interval

# critical value for 2.5% quantile
c_val = qt(0.025, df = 1173, lower.tail = FALSE) %>% 
  print()

# confidence interval bounds
# since we saved our ols models as objects earlier, we can call them here

# using coef & SE from above to make 95% CI 

ci_lower <- round(status6$coefficients[2,'Estimate'] - c_val*status6$coefficients[2,'Std. Error'], 3) %>% 
  print()

ci_upper <- round(status6$coefficients[2,'Estimate'] + c_val*status6$coefficients[2,'Std. Error'], 3) %>% 
  print()

print("The first print statment refers to intercept confidence interval, and the second print statement refers to the slope CI")
print(paste0("95% probability that [", ci_lower_murder, " - ", ci_upper_murder, "] contains the difference in murder rates across the mean number of days that regions experienced frost vs no frost experience"))


#ci_lower <- round(point_est - c_val*SE, 2) %>% 
 # print()
#ci_upper <- round(point_est + c_val*SE, 2) %>% 
 # print()

# Display output
print(paste0("95% probability that interval [",ci_lower," ", ci_upper, "] contains the true difference in mean frost days between the North Central and South region."))

```

```{r}


```

### Logit 

### Null Hypothesis

After considering the glm

### The null states, that the wind turbine active `status` is unimpacted by the `is_anti_wind` rating.

Two hypothesis presented are

\$H_0: \text{is_anti_wind} - \text{not_anti_wind} = 0\$

$H_A: \text{is_anti_wind} - \text{not_anti_wind} ≠ 0$

#\-\-\-\-\-\-\-\-\-\-\-\-\-\--idk

```{r}
ggplot(data= wind_us, aes(x = status, y = pop_den)) + geom_jitter(alpha=0.1, size=3) + geom_smooth(method='lm', formula= y~x, color="lightcoral", se=F, size=1.5) + theme_bw() + geom_hline(yintercept=0, color="seagreen")
```
